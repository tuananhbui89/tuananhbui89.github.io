<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Crawling Financial Reports | Tuan-Anh  Bui</title>
    <meta name="author" content="Tuan-Anh  Bui">
    <meta name="description" content="How to get rich as a data scientist =))">
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Bootstrap Table -->
    <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e">
    <link rel="canonical" href="https://tuananhbui89.github.io/projects/project_crawling_financial_reports/">

    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">
    <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script>
    <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Tuan-Anh¬†</span>Bui</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item ">
                <a class="nav-link" href="/blog/">blog</a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/repositories/">repositories</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/teaching/"></a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      
        <!-- _layouts/post.html -->

<div class="post">

  <header class="post-header">
    <h1 class="post-title">Crawling Financial Reports</h1>
    <p class="post-meta">June 25, 2024</p>
    <p class="post-tags">
      <a href="/blog/2024"> <i class="fas fa-calendar fa-sm"></i> 2024 </a>
      ¬† ¬∑ ¬†
        <a href="/blog/category/fun">
          <i class="fas fa-tag fa-sm"></i> fun</a> ¬†
          

    </p>
  </header>

  <article class="post-content">
    
    <div id="markdown-content">
      <p><b style="color:blue;">Update in 2024: Now it can be done easily with some open-source tools such as <a href="https://pypi.org/project/yfinance/" rel="external nofollow noopener" target="_blank">yfinance</a> or <a href="https://pypi.org/project/yahoo_fin/" rel="external nofollow noopener" target="_blank">yahoo_fin</a> or <a href="https://pypi.org/project/zipline/" rel="external nofollow noopener" target="_blank">Zipline</a> or <a href="https://pypi.org/project/pyfolio/" rel="external nofollow noopener" target="_blank">Pyfolio</a>. However, I still keep this post for fun and as a memory of my journey to learn how to invest in the stock market.</b></p>

<p>In 2022, armed with a bit of extra cash and an abundance of free time or being procrastinate (a defining characteristic of a Ph.D. student, as you might already know üòä) I started to learn how to invest in the ASX stock market. As one might expect, I lost almost all of my money because of following the hot trend ‚ÄúBuy Now Pay Later‚Äù at that time with ZiP and IoU. It didn‚Äôt take long for me to realize that perhaps I should not follow the hot trend and instead invest in the company that I understand and believe in its long-term growth as adviced by Warren Buffett. I tried to read the financial reports of some companies but soon realized that it was incredibly time-consuming endeavor. So I decided to crawl the financial reports of all the companies in the ASX and build some automated tools to help me analyze them. And here is it. The code is available on Github <a href="https://github.com/tuananhbui89/crawl_finanical_reports" rel="external nofollow noopener" target="_blank">here</a>.</p>

<blockquote class="block-tip">
  <p><strong>What are the financial reports?</strong></p>

  <p>There are three main financial reports: Balance Sheet, Income Statement, and Cash Flow Statement. The Balance Sheet shows the assets, liabilities, and equity of a company at a specific point in time. The Income Statement shows the revenues, expenses, and profits of a company over a period of time. The Cash Flow Statement shows the cash inflows and outflows of a company over a period of time. The Balance Sheet, Income Statement, and Cash Flow Statement are the three most important financial statements for analyzing a company‚Äôs financial performance.</p>
</blockquote>

<h2 id="where-to-get-the-financial-reports">Where to get the financial reports?</h2>

<p>There are several platforms such as <a href="https://au.finance.yahoo.com/quote/ASX.AX/" rel="external nofollow noopener" target="_blank">Yahoo Finance</a>, that you can get the financial reports of the companies not only ASX but also other stock markets such as NYSE, NASDAQ, etc. However, I found that the most friendly platform is <a href="https://www.marketwatch.com/investing/stock/asx/financials?countrycode=au&amp;mod=mw_quote_tab" rel="external nofollow noopener" target="_blank">Market Watch</a> because it provides the financial reports in a table format, which is easy to crawl. For example, the financial reports of <a href="https://www.marketwatch.com/investing/stock/asx/financials?countrycode=au&amp;mod=mw_quote_tab" rel="external nofollow noopener" target="_blank">ASX</a> is shown as follows:</p>

<figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/crawl_reports/marketwatch-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/crawl_reports/marketwatch-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/crawl_reports/marketwatch-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/crawl_reports/marketwatch.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">
  </picture>

</figure>

<p>It also provides in annual and quarterly format.</p>

<h2 id="how-to-crawl-the-financial-reports">How to crawl the financial reports?</h2>

<p>Actually, this tool is not something fancy and difficult to implement, so please ease your expectation and go easy on me <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">.</p>

<h3 id="utilities">Utilities</h3>

<p><strong>Get the url of the financial reports of a company given its share code.</strong> There are 6 urls in total: 2 for Balance Sheet, 2 for Income Statement, and 2 for Cash Flow Statement, annual and quarterly. Market Watch organizes these reports in very reasonable urls, so it is easy to get the urls of the reports given the share code. The following function is used to get the urls of the reports given the share code. You can change the country code to get the reports of other stock markets.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="n">share_code</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Get the url of the financial reports of a company given its share code. 
    There are 6 urls in total: 2 for Balance Sheet, 2 for Income Statement, and 2 for Cash Flow Statement, annual and quarterly.
    </span><span class="sh">"""</span>
    <span class="n">url_bs_y</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.marketwatch.com/investing/stock/{}/financials/balance-sheet?countrycode=au</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>
    <span class="n">url_bs_q</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.marketwatch.com/investing/stock/{}/financials/balance-sheet/quarter?countrycode=au</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>

    <span class="n">url_is_y</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.marketwatch.com/investing/stock/{}/financials?countrycode=au</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>
    <span class="n">url_is_q</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.marketwatch.com/investing/stock/{}/financials/income/quarter?countrycode=au</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>

    <span class="n">url_cf_y</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.marketwatch.com/investing/stock/{}/financials/cash-flow?countrycode=au</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>
    <span class="n">url_cf_q</span> <span class="o">=</span> <span class="sh">'</span><span class="s">https://www.marketwatch.com/investing/stock/{}/financials/cash-flow/quarter?countrycode=au</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>

    <span class="n">url_dict</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">()</span>
    <span class="n">url_dict</span><span class="p">[</span><span class="sh">'</span><span class="s">bs_y</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_bs_y</span>
    <span class="n">url_dict</span><span class="p">[</span><span class="sh">'</span><span class="s">bs_q</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_bs_q</span>
    <span class="n">url_dict</span><span class="p">[</span><span class="sh">'</span><span class="s">is_y</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_is_y</span>
    <span class="n">url_dict</span><span class="p">[</span><span class="sh">'</span><span class="s">is_q</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_is_q</span>
    <span class="n">url_dict</span><span class="p">[</span><span class="sh">'</span><span class="s">cf_y</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_cf_y</span>
    <span class="n">url_dict</span><span class="p">[</span><span class="sh">'</span><span class="s">cf_q</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">url_cf_q</span>
    <span class="k">return</span> <span class="n">url_dict</span>
</code></pre></div></div>

<p>Because there are a lot of features in the financial reports, I only focus on some key features that I think are important. For example, in the Balance Sheet, I only focus on the Assets and Liabilities, with some important keys such as Cash &amp; Short Term Investments, Inventories, Total Current Assets, Intangible Assets, Total Assets, etc. The <code class="language-plaintext highlighter-rouge">get_table_keys</code> function is used to get some key features of the financial reports given the sheet key.</p>

<h3 id="main-function">Main Function</h3>

<p>The main function is shown as follows. It reads all the ASX share codes from the <code class="language-plaintext highlighter-rouge">asx-companies-list.csv</code> file (sorry, I forgot how to get this list). Then it iterates through all the share codes and run <code class="language-plaintext highlighter-rouge">process_one</code> function to crawl the financial reports of each company. The <code class="language-plaintext highlighter-rouge">process_one</code> function is shown in the next section.</p>

<p>Important notes: Maybe Market Watch has some mechanism to prevent the crawler, so sometimes it will return an error. In this case, I add the error share codes to a list and save it to a file. Then I can run the crawler again with the error share codes to get the reports of these companies. Maybe adding some delay between each request will help to prevent the error.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main_process</span><span class="p">():</span>
    <span class="c1"># Read all codes 
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">asx-companies-list.csv</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">codes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">Code</span><span class="sh">'</span><span class="p">]</span> <span class="c1"># format 'ASX:BHP'
</span>    <span class="c1"># codes = ['ASX:CBA', 'ASX:NAB', 'ASX:WBC', 'ASX:ANZ', 'ASX:BEN', 'ASX:BOQ'] # custom codes
</span>
    <span class="n">error_codes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">share_code</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">codes</span><span class="p">):</span> 
        <span class="n">share_code</span> <span class="o">=</span> <span class="n">share_code</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">ASX:</span><span class="sh">'</span><span class="p">,</span><span class="sh">''</span><span class="p">).</span><span class="nf">lower</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">---------------</span><span class="sh">'</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Processing {}/{} - code = {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">codes</span><span class="p">),</span> <span class="n">share_code</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="nf">process_one</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>  
            <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">:</span> 
                <span class="nf">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
                <span class="n">error_codes</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>      
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> 
            <span class="nf">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">error_codes</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>

    <span class="n">df_error_codes</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">error_codes</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">code</span><span class="sh">'</span><span class="p">])</span>
    <span class="n">df_error_codes</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">error_codes.csv</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="process-one-function">Process One Function</h3>

<p>The following code is the main function to crawl the financial reports of a company given its share code. It iterates through all the sheets (Balance Sheet, Income Statement, and Cash Flow Statement) and all the tables in each sheet. Then it saves the reports to an excel file. It uses BeautifulSoup to parse the html.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">RUN_FILES</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">bs_y</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">is_y</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">cf_y</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">bs_q</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">is_q</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">cf_q</span><span class="sh">'</span><span class="p">]</span>
<span class="n">TIME_SLEEP</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># second
</span>
<span class="k">def</span> <span class="nf">process_one</span><span class="p">(</span><span class="n">share_code</span><span class="p">):</span> 
    <span class="n">out_file_name</span> <span class="o">=</span> <span class="sh">'</span><span class="s">asx/{}.xlsx</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>
    <span class="n">raw_file_name</span> <span class="o">=</span> <span class="sh">'</span><span class="s">asx/raw_{}.npy</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>

    <span class="n">url_dict</span> <span class="o">=</span> <span class="nf">get_url</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">sheet_key</span> <span class="ow">in</span> <span class="n">RUN_FILES</span><span class="p">:</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">TIME_SLEEP</span><span class="p">)</span>
            <span class="c1"># print('---------------')
</span>            <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Start crawling share={}, report={}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">share_code</span><span class="p">,</span> <span class="n">sheet_key</span><span class="p">))</span>
            <span class="n">url_</span> <span class="o">=</span> <span class="n">url_dict</span><span class="p">[</span><span class="n">sheet_key</span><span class="p">]</span>
            <span class="n">table_keys</span> <span class="o">=</span> <span class="nf">get_table_keys</span><span class="p">(</span><span class="n">sheet_key</span><span class="p">)</span>

            <span class="n">req</span> <span class="o">=</span> <span class="nc">Request</span><span class="p">(</span><span class="n">url_</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">User-Agent</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Mozilla/5.0</span><span class="sh">'</span><span class="p">})</span>    
            <span class="n">read_data</span> <span class="o">=</span> <span class="nf">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">).</span><span class="nf">read</span><span class="p">()</span>
            <span class="n">soup_is</span><span class="o">=</span> <span class="nc">BeautifulSoup</span><span class="p">(</span><span class="n">read_data</span><span class="p">,</span><span class="sh">'</span><span class="s">lxml</span><span class="sh">'</span><span class="p">)</span>

            <span class="n">ls</span><span class="o">=</span> <span class="p">[]</span> <span class="c1"># Create empty list
</span>            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">soup_is</span><span class="p">.</span><span class="nf">find_all</span><span class="p">(</span><span class="sh">'</span><span class="s">div</span><span class="sh">'</span><span class="p">):</span> 
                <span class="c1">#Find all data structure that is ‚Äòdiv‚Äô
</span>                <span class="n">ls</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">string</span><span class="p">)</span> <span class="c1"># add each element one by one to the list
</span>

            <span class="n">exclude_keys</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sh">'</span><span class="s">Operating Expenses</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Non-recurring Events</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">table_keys</span><span class="p">[</span><span class="sh">'</span><span class="s">period_key</span><span class="sh">'</span><span class="p">],</span>
            <span class="p">]</span>
            <span class="n">ls</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ls</span> <span class="k">if</span> <span class="n">e</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_keys</span><span class="p">]</span> <span class="c1"># Exclude those columns
</span>
            <span class="n">new_ls</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">ls</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">cut_invalid_in_end</span><span class="p">(</span><span class="n">dataframe</span><span class="p">):</span> 
                <span class="nf">assert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nf">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="n">dataframe</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dataframe</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                        <span class="k">break</span> 
                <span class="n">invalid</span> <span class="o">=</span> <span class="nf">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nf">len</span><span class="p">(</span><span class="n">dataframe</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">new_dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">invalid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">new_dataframe</span>


            <span class="n">start_idxes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">new_ls</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="sh">'</span><span class="s">Item</span><span class="sh">'</span><span class="p">:</span>
                    <span class="n">start_idxes</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

            <span class="nf">assert</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">start_idxes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">table_keys</span><span class="p">[</span><span class="sh">'</span><span class="s">num_tables</span><span class="sh">'</span><span class="p">])</span>

            <span class="n">list_df</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">t_idx</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">table_keys</span><span class="p">[</span><span class="sh">'</span><span class="s">num_tables</span><span class="sh">'</span><span class="p">]):</span> 
                <span class="k">if</span> <span class="n">t_idx</span> <span class="o">==</span> <span class="n">table_keys</span><span class="p">[</span><span class="sh">'</span><span class="s">num_tables</span><span class="sh">'</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">short_ls</span> <span class="o">=</span> <span class="n">new_ls</span><span class="p">[</span><span class="n">start_idxes</span><span class="p">[</span><span class="n">t_idx</span><span class="o">*</span><span class="mi">2</span><span class="p">]:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">short_ls</span> <span class="o">=</span> <span class="n">new_ls</span><span class="p">[</span><span class="n">start_idxes</span><span class="p">[</span><span class="n">t_idx</span><span class="o">*</span><span class="mi">2</span><span class="p">]:</span><span class="n">start_idxes</span><span class="p">[</span><span class="n">t_idx</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">]]</span>
                
                <span class="n">is_data</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nf">iter</span><span class="p">(</span><span class="n">short_ls</span><span class="p">)]</span><span class="o">*</span><span class="mi">7</span><span class="p">))</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">is_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:])</span>
                <span class="n">new_df</span> <span class="o">=</span> <span class="nf">cut_invalid_in_end</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="c1"># data[table_keys['tab_names'][t_idx]] = new_df
</span>                <span class="n">list_df</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>

            <span class="c1"># Concat all tables in one sheet 
</span>            <span class="n">list_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">(</span><span class="n">list_df</span><span class="p">)</span>

            <span class="c1"># Remove first col 
</span>            <span class="n">data</span><span class="p">[</span><span class="n">sheet_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">list_df</span><span class="p">.</span><span class="nf">drop</span><span class="p">(</span><span class="n">list_df</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Finish crawling {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">sheet_key</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">pd</span><span class="p">.</span><span class="nc">ExcelWriter</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sheet_key</span> <span class="ow">in</span> <span class="n">RUN_FILES</span><span class="p">:</span>
                <span class="c1"># use to_excel function and specify the sheet_name and index
</span>                <span class="c1"># to store the dataframe in specified sheet
</span>                <span class="n">data</span><span class="p">[</span><span class="n">sheet_key</span><span class="p">].</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_key</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span> 
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">e</span> 
</code></pre></div></div>

<h2 id="how-to-compare-the-financial-reports">How to compare the financial reports?</h2>

<p>In this project, I also developed a tools to compare some finanical indicators among companies in the same sector. The code can be found in the file <code class="language-plaintext highlighter-rouge">02_compare_fin_reports.py</code>.</p>

<p>Let me go through top-down the code, from the main function to the helpers.</p>

<h3 id="main-process">Main Process</h3>

<p>The following code helps to compare between Dairy companies provided by <code class="language-plaintext highlighter-rouge">codes = ['ASX:A2M', 'ASX:BUB', 'ASX:CLV', 'ASX:AHF', 'ASX:SM1', 'ASX:NUC']</code>. It reads the financial reports of these companies from the excel files saved in the previous section, to build a dataframe for each company. Then it compares the indicators of these companies and save the results to an excel file. You can do some fancy visualization with these results.</p>

<p>The final results is something like this:</p>

<figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/crawl_reports/compare-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/crawl_reports/compare-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/crawl_reports/compare-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/crawl_reports/compare.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">
  </picture>

</figure>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main_process</span><span class="p">():</span>
    <span class="c1"># Read all codes 
</span>    <span class="n">out_file_name</span> <span class="o">=</span> <span class="sh">'</span><span class="s">compare/dairy.xlsx</span><span class="sh">'</span>
    <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">ASX:A2M</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ASX:BUB</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ASX:CLV</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ASX:AHF</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ASX:SM1</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">ASX:NUC</span><span class="sh">'</span><span class="p">]</span>

    <span class="n">all_data</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">share_code</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">codes</span><span class="p">):</span> 
        <span class="n">share_code</span> <span class="o">=</span> <span class="n">share_code</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">ASX:</span><span class="sh">'</span><span class="p">,</span><span class="sh">''</span><span class="p">).</span><span class="nf">lower</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">---------------</span><span class="sh">'</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Processing {}/{} - code = {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">codes</span><span class="p">),</span> <span class="n">share_code</span><span class="p">))</span>

        <span class="n">all_data</span><span class="p">[</span><span class="n">share_code</span><span class="p">]</span> <span class="o">=</span> <span class="nf">process_one</span><span class="p">(</span><span class="n">share_code</span><span class="p">)</span>  

    <span class="n">data</span> <span class="o">=</span> <span class="nf">dict</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">annual</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">compare_report</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="sh">'</span><span class="s">annual</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">quarter</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">compare_report</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="sh">'</span><span class="s">quarter</span><span class="sh">'</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pd</span><span class="p">.</span><span class="nc">ExcelWriter</span><span class="p">(</span><span class="n">out_file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">annual</span><span class="sh">'</span><span class="p">].</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sh">'</span><span class="s">annual</span><span class="sh">'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">quarter</span><span class="sh">'</span><span class="p">].</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="sh">'</span><span class="s">quarter</span><span class="sh">'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="helpers">Helpers</h3>

<p>Below are some important helpers that are used in the main function. To avoid the post is too long, I just explain the main idea of each helper. You can find the full code in the Github repo.</p>

<p><strong>Process One Function</strong>: To read the financial reports from the excel files saved in the previous section, add new indicators, and return a dataframe. It combines all three reports (Balance Sheet, Income Statement, and Cash Flow Statement) into one dataframe.</p>

<p><strong>Compare Report Function</strong>: Read the dataframe, remove unimportant indicators, and compare the important ones. Indicators can be concatenated vertically (as shown in the above figure) or horizontally.</p>

<p><strong>Add New Indicators Function</strong>: This function helps to create new indicators from the existing ones. For example, the <code class="language-plaintext highlighter-rouge">Current Ratio</code> is calculated from <code class="language-plaintext highlighter-rouge">Total Current Assets</code> and <code class="language-plaintext highlighter-rouge">Total Current Liabilities</code>, or <code class="language-plaintext highlighter-rouge">Quick Ratio</code> is calculated from <code class="language-plaintext highlighter-rouge">Total Accounts Receivable</code> and <code class="language-plaintext highlighter-rouge">Total Current Liabilities</code>.</p>

<p><strong>Imporatant Indicators</strong> are defined in the global variable <code class="language-plaintext highlighter-rouge">INDICATORS</code>. You can add more indicators in your own preference. Here is my list</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">INDICATORS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">'</span><span class="s">Item</span><span class="sh">'</span><span class="p">,</span>
    <span class="c1"># Income statement 
</span>    <span class="sh">'</span><span class="s">Gross Income</span><span class="sh">'</span><span class="p">,</span> 
    <span class="sh">'</span><span class="s">Gross Income Growth</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Gross Profit Margin</span><span class="sh">'</span><span class="p">,</span> 
    <span class="sh">'</span><span class="s">Pretax Income</span><span class="sh">'</span><span class="p">,</span> 
    <span class="sh">'</span><span class="s">Pretax Margin</span><span class="sh">'</span><span class="p">,</span> 
    <span class="sh">'</span><span class="s">Net Income</span><span class="sh">'</span><span class="p">,</span> 
    <span class="sh">'</span><span class="s">EBITDA</span><span class="sh">'</span><span class="p">,</span>
    <span class="c1"># Balance sheet 
</span>    <span class="sh">'</span><span class="s">Cash &amp; Short Term Investments</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Inventories</span><span class="sh">'</span><span class="p">,</span> 
    <span class="sh">'</span><span class="s">Total Current Assets</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Intangible Assets</span><span class="sh">'</span><span class="p">,</span> 
    <span class="sh">'</span><span class="s">Total Assets</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Total Current Liabilities</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Current Ratio</span><span class="sh">'</span><span class="p">,</span> 
    <span class="sh">'</span><span class="s">Quick Ratio</span><span class="sh">'</span><span class="p">,</span> 
    <span class="sh">'</span><span class="s">Accounts Receivable Turnover</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">Inventory Turnover</span><span class="sh">'</span><span class="p">,</span>
    <span class="c1"># Cash flow 
</span><span class="p">]</span>
</code></pre></div></div>

    </div>
  </article>


  
    
    <br>
    <hr>
    <br>
    <ul class="list-disc pl-8"></ul>

    <!-- Adds related posts to the end of an article -->
    <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2>
    <p class="mb-2">Here are some more articles you might like to read next:</p>
  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/nlp-foundation/">LLM Series - Part 1 - Important Concepts in NLP</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/thoughts/">Random Thoughts and Notes</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/diffusion-foundation/">Foundation of Diffusion Models</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/dna-tree/">DNA Series - Part 4 - Tree</a>
  </li>

  

  <li class="my-2">
    <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/dna-array/">DNA Series - Part 2 - Array</a>
  </li>

</div>

      
    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        ¬© Copyright 2025 Tuan-Anh  Bui. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script>

  <!-- Bootstrap Table -->
  <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script>

  <!-- Load Common JS -->
  <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script>
  <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script>
  <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7KGSMMS9MS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ window.dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-7KGSMMS9MS');
  </script>
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

    
  </body>
</html>
