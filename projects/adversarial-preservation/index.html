<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Erasing Undesirable Concepts in Diffusion Models with Adversarial Preservation | Tuan-Anh  Bui</title>
    <meta name="author" content="Tuan-Anh  Bui">
    <meta name="description" content="Researcher in Generative AI and Trustworthy AI
">
    <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Bootstrap Table -->
    <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    

    <!-- Styles -->
    
    <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;">
    
    <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e">
    <link rel="canonical" href="https://tuananhbui89.github.io/projects/adversarial-preservation/">

    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">
    <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script>
    <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Tuan-Anh </span>Bui</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              
              <!-- Blog -->
              <li class="nav-item ">
                <a class="nav-link" href="/blog/">blog</a>
              </li>

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/repositories/">repositories</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/teaching/"></a>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      
        <!-- page.html -->
        <div class="post">

          <header class="post-header">
            <h1 class="post-title">Erasing Undesirable Concepts in Diffusion Models with Adversarial Preservation</h1>
            <p class="post-description"></p>
          </header>

          <article>
            <div style="text-align: center;">
Tuan-Anh Bui<sup>1</sup>, Vuong Long<sup>1</sup>, Khanh Doan<sup>2</sup>, Trung Le<sup>1</sup>, Paul Montague<sup>3</sup>, Tamas Abraham<sup>3</sup>, Dinh Phung

<sup>1</sup> Monash University, Australia;
<sup>2</sup> VinAI Research, Vietnam;
<sup>3</sup> Defence Science and Technology Group, Australia

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <a href="https://github.com/tuananhbui89/Erasing-Adversarial-Preservation" class="btn btn-primary" target="_blank" rel="external nofollow noopener">GitHub</a>
        <a href="https://arxiv.org/abs/2410.15618" class="btn btn-secondary" target="_blank" rel="external nofollow noopener">arXiv</a>
        <a href="https://www.dropbox.com/scl/fi/jmqtqp939jfr7p3xrel8x/2024-AP-compact.pdf?rlkey=bzkhlhmg63efijlzo51mpnwzf&amp;st=69no55kd&amp;dl=0" class="btn btn-orange" target="_blank" rel="external nofollow noopener">Slides</a>
        <a href="https://www.dropbox.com/scl/fi/41kvbtc4jr0zowoyjcgay/NeurIPS-2024-AP.pdf?rlkey=sgu12b67gyk5r6240i4z48urp&amp;st=iff788ae&amp;dl=0" class="btn btn-success" target="_blank" rel="external nofollow noopener">Poster</a>
    </div>
</div>
</div>

<p><strong>(Shameless plug <img class="emoji" title=":grin:" alt=":grin:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f601.png" height="20" width="20">) Our other papers on Concept Erasing/Unlearning:</strong></p>

<blockquote>
  <p><a href="https://arxiv.org/abs/2501.18950" rel="external nofollow noopener" target="_blank"><strong>Fantastic Targets for Concept Erasure in Diffusion Models and Where to Find Them</strong></a>,     <br>
Tuan-Anh Bui, Thuy-Trang Vu, Long Vuong, Trung Le, Paul Montague, Tamas Abraham, Junae Kim, Dinh Phung     <br>
<em>ICLR 2025 (<a href="https://arxiv.org/abs/2501.18950" rel="external nofollow noopener" target="_blank">arXiv 2501.18950</a>)</em></p>
</blockquote>

<blockquote>
  <p><a href="https://arxiv.org/abs/2410.15618" rel="external nofollow noopener" target="_blank"><strong>Erasing Undesirable Concepts in Diffusion Models with Adversarial Preservation</strong></a>,     <br>
Tuan-Anh Bui, Long Vuong, Khanh Doan, Trung Le, Paul Montague, Tamas Abraham, Dinh Phung     <br>
<em>NeurIPS 2024 (<a href="https://arxiv.org/abs/2410.15618" rel="external nofollow noopener" target="_blank">arXiv 2410.15618</a>)</em></p>
</blockquote>

<blockquote>
  <p><a href="https://arxiv.org/abs/2403.12326" rel="external nofollow noopener" target="_blank"><strong>Hiding and Recovering Knowledge in Text-to-Image Diffusion Models via Learnable Prompts</strong></a>,     <br>
Tuan-Anh Bui, Khanh Doan, Trung Le, Paul Montague, Tamas Abraham, Dinh Phung     <br>
<em>Preprint (<a href="https://arxiv.org/abs/2403.12326" rel="external nofollow noopener" target="_blank">arXiv 2403.12326</a>)</em></p>
</blockquote>

<h2 id="abstract">Abstract</h2>

<p>Diffusion models excel at generating visually striking content from text but can inadvertently produce undesirable or harmful content when trained on unfiltered internet data. A practical solution is to selectively removing target concepts from the model, but this may impact the remaining concepts. Prior approaches have tried to balance this by introducing a loss term to preserve neutral content or a regularization term to minimize changes in the model parameters, yet resolving this trade-off remains challenging. In this work, we propose to identify and preserving concepts most affected by parameter changes, termed as <strong>adversarial concepts</strong>. This approach ensures stable erasure with minimal impact on the other concepts. We demonstrate the effectiveness of our method using the Stable Diffusion model, showing that it outperforms state-of-the-art erasure methods in eliminating unwanted content while maintaining the integrity of other unrelated elements.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/AP_arXiv/NeurIPS-2024-AP-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/AP_arXiv/NeurIPS-2024-AP-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/AP_arXiv/NeurIPS-2024-AP-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/AP_arXiv/NeurIPS-2024-AP.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">
  </picture>

</figure>

    </div>
</div>

<h3 id="key-observations-and-motivations">Key Observations and Motivations</h3>

<p><strong>(1)</strong> Erasing different target concepts from text-to-image diffusion models leads to varying impacts on the remaining concepts. For instance, removing ‘nudity’ significantly affects related concepts like ‘women’ and ‘men’ but has minimal impact on unrelated concepts like ‘garbage truck.’
<strong>(2)</strong> Neutral concepts lie in the middle of the sensitivity spectrum, suggesting that they do not adequately represent the model’s capability to be preserved.
<strong>(3)</strong> Furthermore, the choice of concept to be preserved during erasure significantly impacts the model’s generative capability; relying on neutral concepts, as in previous work, is not an optimal solution.
<strong>(4)</strong> This highlights the need for adaptive methods to identify and preserve the most sensitive concepts related to the target concept being erased, rather than relying on fixed neutral/generic concepts.</p>

<h2 id="naive-concept-erasure">Naive Concept Erasure</h2>

<p>There are two main tasks in concept erasure: (1) removing unwanted concepts and (2) preserving the remaining concepts so that the model’s generative capability is not impaired. The first task can be achieved by simply mapping the unwanted concept to a neutral concept such as “a photo” or empty string, which can be formulated as the following optimization problem:</p>

\[\begin{equation}
    \underset{\theta^{'}}{\min} \; \mathbb{E}_{c_e \in \mathbf{E}} \left[ \left\| \epsilon_{\theta^{'}}(c_e) - \epsilon_{\theta}(c_n) \right\|_2^2 \right]
\end{equation}\]

<p>where \(\epsilon_{\theta}\) and \(\epsilon_{\theta^{'}}\) are the denoising diffusion models with the original foundation model \(\theta\) and the sanitized model \(\theta^{'}\), respectively. \(c_e\) and \(c_n\) are the unwanted and neutral concepts.</p>

<p>Therefore, most existing methods focus on the second task, either by introducing a loss term to preserve neutral content [1,2]</p>

\[\begin{equation}
    L = \left\| \epsilon_{\theta^{'}}(c_n) - \epsilon_{\theta}(c_n) \right\|_2^2
\end{equation}\]

<p>or a regularization term to minimize changes in the model parameters [3,4]
\(\begin{equation}
    L = \left\| \theta^{'} - \theta \right\|_2^2
\end{equation}\).</p>

<p>However, there is a lack of understanding on how the removal of a concept affects the model’s generative capability.</p>

<h2 id="impact-of-concept-removal-on-the-model-performance">Impact of Concept Removal on the Model Performance</h2>

<p>We here approach the problem more carefully via a study on the impact of erasing a specific concept on model performance on the remaining ones. More importantly, we are concerned with the <strong>most sensitive concepts</strong> to erasure.</p>

<p>For example, when removing the concept of “nudity”, we are curious to know which concepts change the most in the model’s output, so that we can preserve these concepts specifically to ensure the model’s capability is maintained, at least with respect to these concepts.</p>

<p>We observe the following phenomenons:</p>

<p><strong>(1) The Removal of Different Target Concepts Leads to Different Side-Effects.</strong></p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/AP_arXiv/SDv14/compare-ESD-nudity-ESD-garbage-truck-similarity_clip_nudity_20_side_by_side-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/AP_arXiv/SDv14/compare-ESD-nudity-ESD-garbage-truck-similarity_clip_nudity_20_side_by_side-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/AP_arXiv/SDv14/compare-ESD-nudity-ESD-garbage-truck-similarity_clip_nudity_20_side_by_side-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/AP_arXiv/SDv14/compare-ESD-nudity-ESD-garbage-truck-similarity_clip_nudity_20_side_by_side.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">
  </picture>

</figure>

    </div>
</div>
<div class="caption">
    Analysis of the impact of erasing the target concept on the model's capability. The impact is measured by the difference of CLIP score $\delta(c)$ between the original model and the corresponding sanitized model.
</div>

<p>Figure above shows the impact of the removal of two distinct concepts, “nudity” and “garbage truck”, on other concepts, measured by the difference of the CLIP score, 
\(\delta_{\text{'nudity'}}(c), \delta_{\text{'garbage truck'}}(c)\). A larger \(\delta(c)\) indicates a greater negative impact on the model’s ability to generate concept \(c\).</p>

<p>It can be seen that removing the “nudity” concept significantly affects highly related concepts such as “naked”, “men”, “women”, and “person”, while having minimal impact on unrelated concepts such as “garbage truck”, ‘bamboo’ or neutral concepts such as “a photo” or the null “ “ concept.</p>

<p>Similarly, removing the “garbage truck” concept significantly reduces the model’s capability on concepts like “boat”, “car”, “bus”, while also having little impact on other unrelated concepts such as “naked”, “women” or neutral concepts.</p>

<p>These results suggest that removing different target concepts leads to varying impacts on other concepts. This indicates the need for an adaptive method to identify the most sensitive concepts relative to a particular target concept, rather than relying on random or fixed concepts for preservation. Moreover, in both cases, neutral concepts like “a photo” or the null concept show resilience and independence from changes in the model’s parameters, suggesting that they do not adequately represent the model’s capability to be preserved.</p>

<p><strong>(2) Neutral Concepts lie in the Middle of the Sensitivity Spectrum.</strong></p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/AP_arXiv/SDv14/compare_histogram_nudity_esd-nudity_20_CLIP_2-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/AP_arXiv/SDv14/compare_histogram_nudity_esd-nudity_20_CLIP_2-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/AP_arXiv/SDv14/compare_histogram_nudity_esd-nudity_20_CLIP_2-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/AP_arXiv/SDv14/compare_histogram_nudity_esd-nudity_20_CLIP_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">
  </picture>

</figure>

    </div>
</div>
<div class="caption">
    Sensitivity spectrum of concepts to the target concept "nudity". The histogram shows the distribution of the similarity score between outputs of the original model $\theta$ and the corresponding sanitized model $\theta_{c_e}'$ for each concept $c$ from the CLIP tokenizer vocabulary.
</div>

<p>Figure above shows the distribution of similarity scores between the outputs of the original model \(\theta\) and the sanitized model \(\theta_{c_e}'\) for each concept \(c\) from the CLIP tokenizer vocabulary.</p>

<p>The histogram reveals that the similarity scores span a wide range, indicating that the impact of unlearning the target concept on generating other concepts varies significantly. 
The lower the similarity score, the more different the outputs of the two models are, and the more sensitive the concept is to the target concept. 
Notably, the more related concepts like “women” or “men” are more sensitive to the removal of “nudity” than many neutral concepts that lie in the middle of the sensitivity spectrum.</p>

<p><strong>(3)What Concept should be Kept to Maintain Model Performance?</strong></p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/AP_arXiv/SDv14/SD-v1-4-ESD-garbage-truck-AE-similarity_clip_nudity_20_side_by_side-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/AP_arXiv/SDv14/SD-v1-4-ESD-garbage-truck-AE-similarity_clip_nudity_20_side_by_side-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/AP_arXiv/SDv14/SD-v1-4-ESD-garbage-truck-AE-similarity_clip_nudity_20_side_by_side-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/AP_arXiv/SDv14/SD-v1-4-ESD-garbage-truck-AE-similarity_clip_nudity_20_side_by_side.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">
  </picture>

</figure>

    </div>
</div>
<div class="caption">
    Comparing the impact of erasing the same "garbage truck" to other concepts with different preserving strategies, including preserving a fixed concept such as " ", "lexus", or "road", and adaptively preserving the most sensitive concept found by our method.
</div>

<p>Figure above presents the results of an experiment similar to the previous one, with one key difference: we utilize the prior knowledge gained from the previous experiment. 
Specifically, when erasing the “garbage truck”, we apply different preservation strategies, including preserving a fixed concept such as “ “, “lexus”, or “road”, and adaptively preserving the most sensitive concept found by our method.</p>

<p>The results show that with simple preservation strategies such as preserving a fixed but related concept like “road”, the model’s capability on other concepts is better maintained compared to preserving a neutral concept.
However, the results of adaptively preserving the most sensitive concept show the best performance, with the least side effects on other concepts.</p>

<h2 id="our-approach---adversarial-preservation">Our Approach - Adversarial Preservation</h2>

<p>Motivated by the observations in the previous section, our approach involves identifying the most sensitive concepts related to a specific target concept. For example, when removing the concept of nudity, we identify which concepts are most affected in the model’s output so that we can specifically preserve these concepts to ensure the model’s capability is maintained.</p>

<p>In each iteration, before updating the model parameters, we first identify the concept \(c_a\) that is most sensitive to changes in the model parameters as we work to remove the target concepts.</p>

\[\begin{equation}
    \underset{\theta^{'}}{\min} \; \underset{c_a\in \mathcal{R}}{\text{max}} \; \mathbb{E}_{c_e \in \mathbf{E}} \left[ \underbrace{\left\|\epsilon_{\theta^{'}}(c_e) - \epsilon_{\theta}(c_n) \right\|_2^2}_{L_1}  + \lambda \underbrace{\left\|\epsilon_{\theta^{'}}(c_a) - \epsilon_{\theta}(c_a)\right\|_2^2}_{L_2}  \right] \\
\end{equation}\]

<p>where \(\lambda &gt;0\) is a parameter and  \(\mathcal{R}=\mathcal{C}\setminus\mathbf{E}\) denotes the remaining concepts.</p>

<p>Objective loss \(L_1\) is the same as in the naive approach, aiming to erase the target concept \(c_e\) by forcing its output to match that of a neutral concept.
Our main contribution lies in the introduction of the adversarial preservation loss \(L_2\), which aims to identify the most sensitive concept \(c_a\) that is most affected by changes in the model parameters when removing the target concepts.</p>

<h3 id="challenges-of-searching-in-continuous-space-for-adversarial-concepts">Challenges of Searching in Continuous Space for Adversarial Concepts</h3>

<p>Since the concepts exist in a discrete space, the straightforward approach would involve revisiting all concepts in
\(\mathcal{R}\), resulting in significant computational complexity. Another naive approach is to consider the concepts as lying in a continuous space and use the Projected Gradient Descent (PGD) method [5] to search within the local region of the continuous space of the concepts.</p>

<p>More specifically, we initialize the adversarial prompt with the text embedding of the to-be-erased concept, e.g., \(c_{a,0}=c_e=\tau({\text{"Garbage Truck"}})\), and then update the adversarial concept with gradient \(\nabla_{c_a} L_2\).</p>

<p>Interestingly, while this approach provides an efficient computational method, we find that the adversarial concept quickly collapses from the initial concept to a background concept with the color information of the object as shown in the first row of Figure below.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/AP_arXiv/intermediate/adversarial_gumbel_garbage_truck_01-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/AP_arXiv/intermediate/adversarial_gumbel_garbage_truck_01-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/AP_arXiv/intermediate/adversarial_gumbel_garbage_truck_01-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/AP_arXiv/intermediate/adversarial_gumbel_garbage_truck_01.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">
  </picture>

</figure>

    </div>
</div>
<div class="caption">
    Images generated from the most sensitive concepts found by our method over the fine-tuning process. Top: Continous search with PGD. Bottom: Discrete search with Gumbel-Softmax. $c_a$ represents for the keyword.
</div>

<p>This can be explained by the fact that while the concepts lie in a discrete space, their embeddings lie in a continuous space \(R^d\) and the gradient of the loss function \(L_2\) is computed in this continuous space. Therefore, the update step \(c_{a,t+1} = c_{a,t} + \eta \nabla_{c_a} L_2\) moves the embedding of \(c_a\) towards the direction of the gradient, which is unlikely to be one of the discrete concepts.</p>

<p>To combine the benefits of both approaches—making the process continuous and differentiable for efficient training while achieving meaningful concepts that are related to the target concept (second row of above Figure)— we first define a distribution over the discrete concept embedding vector space as
\(\mathbb{P}_{\mathcal{R},\pi}=\sum_{i=1}^{\left | \mathcal{R}  \right |}\pi_{i}\delta_{e_{i}}\)
with the Dirac delta function 
\(\delta\) and the weights \(\pi\in\Delta_{\mathcal{R}}= \{\pi'\geq \boldsymbol{0}: \Vert \pi'\Vert_1 =1\}\). Instead of directly searching for the most sensitive concept \(c_a\) in the discrete concept embedding vector space \(\mathcal{R}\), we switch to searching for the embedding distribution \(\pi\) on the simplex \(\Delta_{\mathcal{R}}\) and subsequently transform it back into a discrete space using the temperature-dependent GumbelSoftmax trick [6] as follows:</p>

\[\begin{equation}\label{eq:adv-gumbel}
    \underset{\theta^{'}}{\min} \; \underset{\pi\in \Delta_{\mathcal{R}}}{\text{max}} \; \mathbb{E}_{c_e \in \mathbf{E}} \left[ \underbrace{\left\|\epsilon_{\theta^{'}}(c_e) - \epsilon_{\theta}(c_n) \right\|_2^2}_{L_1}  + \lambda \underbrace{\left\|\epsilon_{\theta^{'}}(\mathbf{G}(\pi)\odot \mathcal{R}) - \epsilon_{\theta}(\mathbf{G}(\pi)\odot \mathcal{R})\right\|_2^2}_{L_2}  \right] \\
\end{equation}\]

<p>where \(\lambda &gt;0\) is a parameter,  \(\mathbf{G}\) is Gumbel-Softmax operator and \(\odot\) is element wise multiplication operator. The pseudo-algorithm involves a two-step optimization process, outlined in Algorithm 1,2 in the paper.</p>

<h2 id="experiments">Experiments</h2>

<p>We conducted comprehensive experiments on three erasure tasks to demonstrate the effectiveness of our method. Please refer to the paper for more details.</p>

<p>Beside the experiments that support the superiority of our method (of course as all other papers :D), in this blog post (with more relaxed style), we would like to emphasize some interesting observations that has been discussed in Appendix B of our paper that we think are worthy of future research.</p>

<h3 id="collapsed-concepts">Collapsed Concepts</h3>

<p>As discussed in Appendix B.4, we provide intermediate results of the adversarial concept search process. More specifically, we visualize the images generated by \(c_a\) and \(c_e\) at different steps of the search process.</p>

<p>As shown in the even rows, we observe that the model gradually removes the to-be-erased objects from the generated images as the fine-tuning steps increase.
Interestingly, these to-be-erased concepts <strong>tend to collapse into the same concept</strong>, even though they started from different concepts.</p>

<p>For example, the “Garbage truck” and “Cassette player” in the \(2^\text{nd}\) and \(4^\text{th}\) rows eventually transform into a background-like image in the last column.
This can be explained by the fact that in the objective function, the erasing loss uses the same null concept \(c_n\) for all to-be-erased concepts, 
which encourages the model to remove them simultaneously, eventually leading to the collapse of these concepts into the same form.</p>

<p>Our follow-up work [6] has investigated the phenomenon of collapsed concepts and proposes a method to address it. Please check it out for more details.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/AP_arXiv/intermediate/imagenette_v1_wo_100_100_pgd_2/adversarial_gumbel_combine_all_with_index-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/AP_arXiv/intermediate/imagenette_v1_wo_100_100_pgd_2/adversarial_gumbel_combine_all_with_index-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/AP_arXiv/intermediate/imagenette_v1_wo_100_100_pgd_2/adversarial_gumbel_combine_all_with_index-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/AP_arXiv/intermediate/imagenette_v1_wo_100_100_pgd_2/adversarial_gumbel_combine_all_with_index.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">
  </picture>

</figure>

    </div>
</div>
<div class="caption">
    Intermediate results of the search process. Row-1,3,5,7,9: images generated from the most sensitive concepts $c_a$ found by our method. 
    Row-2,4,6,8,10: images generated from the corresponding to-be-erased concepts. 
    Each column represents different fine-tuning steps in increasing order.
</div>

<h3 id="difficulties-in-searching-for-adversarial-concepts">Difficulties in Searching for Adversarial Concepts</h3>

<p>As discussed in Appendix B.5, we we provide empirical examples to show that finding the most sensitive concept \(c_a\) is not always straightforward when using heuristic methods, which further emphasizes the advantage of our method.</p>

<p><strong>Can we use the similarity in the textual embedding space to find the most sensitive concept?</strong></p>

<p>Large pretrained multimodal models like CLIP have been widely used for zero-shot learning because their textual embedding space is highly correlated with the visual space. Intuitively, one might think that the similarity between the target concept \(c_e\) and other concepts in the textual embedding space can help identify the most sensitive concept \(c_a\). For example, the closer a concept \(c_i\) is to the target concept \(c_e\) in the textual embedding space, the more likely it is to be the most sensitive concept \(c_a\). However, we demonstrate that this heuristic method is not always effective.</p>

<p>Figure below shows the correlation between the drop in the CLIP scores between the base/original model and the sanitized model (i.e., after removing the target concept “nudity”) and the similarity score between the target concept “nudity” and other concepts in the textual embedding space.</p>

<p>It can be seen that the above intuition does not always hold, as the similarity score does not correlate with the drop in the CLIP scores. For example, except for the concept “naked”, the null concept is the most similar to “nudity” in the textual embedding space, but it experiences the lowest drop in CLIP scores. On the other hand, two concepts, “a photo” and “president”, are close in the textual embedding space but are affected differently during the erasing process. This demonstrates that similarity in the textual embedding space is not an appropriate metric for identifying the most sensitive concept in this context.</p>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <figure>

  <picture>
    
    <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/AP_arXiv/SDv14/SD-v1-4-ESD-similarity_clip_nudity_textual_embedding-480.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/AP_arXiv/SDv14/SD-v1-4-ESD-similarity_clip_nudity_textual_embedding-800.webp"></source>
    <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/AP_arXiv/SDv14/SD-v1-4-ESD-similarity_clip_nudity_textual_embedding-1400.webp"></source>
    

    <!-- Fallback to the original file -->
    <img src="/assets/img/AP_arXiv/SDv14/SD-v1-4-ESD-similarity_clip_nudity_textual_embedding.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();">
  </picture>

</figure>

    </div>
</div>
<div class="caption">
    The figure shows the correlation between <em>the drop of the CLIP scores</em> (measured between generated images and their prompts) between the base/original model, 
    and <em>the similarity score</em> between the target concept "nudity" and other concepts in <em>the textual embedding space</em>. The radius of the circle indicates the variance of the CLIP scores measured in 200 samples, i.e., the larger circle indicates the larger variance of the CLIP scores. 
</div>

<h3 id="discussion-on-metrics-to-measure-the-erasure-performance">Discussion on Metrics to Measure the Erasure Performance</h3>

<p>One of the main challenges in developing erasure methods is the lack of a proper metric to measure erasure performance. Specifically, performance is evaluated by how well the model forgets the target concept while retaining other concepts. This raises a critical question: how can we validate whether a concept is present in a generated image? Although this may seem like a simple task, it is quite challenging due to the vast number of concepts that generative models can produce. It is infeasible to have a classification model capable of detecting all possible concepts.</p>

<p>While the FID score is a commonly used metric to assess the generative quality of models, it may not be sufficient for evaluating erasure performance. To the best of our knowledge, the CLIP alignment score is the most suitable existing metric for measuring concept inclusion. However, it is not without limitations. For example, CLIP’s training set does not include NSFW content, making it less reliable for detecting such concepts. We believe that a more comprehensive evaluation metric is still lacking and that developing one would be a valuable direction for future research.</p>

<h2 id="limitations">Limitations</h2>

<ul>
  <li>
    <p>A crucial aspect of our method is the concept space \(\mathcal{R}\), where we search for the most sensitive concept \(c_a\).
In our experiments, we use two vocabularies: the CLIP token vocabulary, which includes 49,408 tokens, and the Oxford 3000 word list, comprising the <a href="https://www.oxfordlearnersdictionaries.com/wordlist/american\_english/oxford3000/" rel="external nofollow noopener" target="_blank">3000 most common English words</a>.
While the CLIP token vocabulary is more comprehensive, it presents challenges due to the large number of nonsensical tokens. Therefore, we use the Oxford 3000-word list to demonstrate the effectiveness of our method in all experiments. However, as revealed later in our follow-up work, the better well-curated concept space can further improve the performance of our method.</p>
  </li>
  <li>
    <p>To search for the adversarial concept \(c_a\) effectively, we employ the Gumbel-Softmax trick to sample from the categorical distribution in the concept space \(\mathcal{R}\). This approach requires feeding the model with the embeddings of the entire concept space \(\mathcal{R}\), which exponentially increases the computational cost as the size of the concept space grows. To mitigate this, we use a subset of the \(K\) most similar concepts to the target concept \(c_e\) to reduce computational costs. The similarity between concepts is calculated using cosine similarity between their embeddings.</p>
  </li>
</ul>

<h2 id="citation">Citation</h2>

<p>If you find this work useful in your research, please consider citing our paper (or our other papers <img class="emoji" title=":grin:" alt=":grin:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f601.png" height="20" width="20">):</p>

<div class="language-bibtex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">@article</span><span class="p">{</span><span class="nl">bui2024erasing</span><span class="p">,</span>
  <span class="na">title</span><span class="p">=</span><span class="s">{Erasing Undesirable Concepts in Diffusion Models with Adversarial Preservation}</span><span class="p">,</span>
  <span class="na">author</span><span class="p">=</span><span class="s">{Bui, Anh and Vuong, Long and Doan, Khanh and Le, Trung and Montague, Paul and Abraham, Tamas and Phung, Dinh}</span><span class="p">,</span>
  <span class="na">booktitle</span><span class="p">=</span><span class="s">{NeurIPS}</span><span class="p">,</span>
  <span class="na">year</span><span class="p">=</span><span class="s">{2024}</span>
<span class="p">}</span>

<span class="nc">@article</span><span class="p">{</span><span class="nl">bui2025fantastic</span><span class="p">,</span>
  <span class="na">title</span><span class="p">=</span><span class="s">{Fantastic Targets for Concept Erasure in Diffusion Models and Where to Find Them}</span><span class="p">,</span>
  <span class="na">author</span><span class="p">=</span><span class="s">{Bui, Anh and Vu, Thuy-Trang and Vuong, Long and Le, Trung and Montague, Paul and Abraham, Tamas and Kim, Junae and Phung, Dinh}</span><span class="p">,</span>
  <span class="na">journal</span><span class="p">=</span><span class="s">{ICLR}</span><span class="p">,</span>
  <span class="na">year</span><span class="p">=</span><span class="s">{2025}</span>
<span class="p">}</span>

<span class="nc">@article</span><span class="p">{</span><span class="nl">bui2024removing</span><span class="p">,</span>
  <span class="na">title</span><span class="p">=</span><span class="s">{Hiding and Recovering Knowledge in Text-to-Image Diffusion Models via Learnable Prompts}</span><span class="p">,</span>
  <span class="na">author</span><span class="p">=</span><span class="s">{Bui, Anh and Doan, Khanh and Le, Trung and Montague, Paul and Abraham, Tamas and Phung, Dinh}</span><span class="p">,</span>
  <span class="na">journal</span><span class="p">=</span><span class="s">{arXiv preprint arXiv:2403.12326}</span><span class="p">,</span>
  <span class="na">year</span><span class="p">=</span><span class="s">{2024}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="references">References</h2>

<p>[1] Rohit Gandikota et al. <em>Erasing concepts from diffusion models</em>. ICCV, 2023.</p>

<p>[2] Bui, Anh, et al. <em>Removing Undesirable Concepts in Text-to-Image Generative Models with Learnable Prompts</em>. arXiv preprint arXiv:2403.12326, 2024.</p>

<p>[3] Eric Zhang et al. <em>Forget-me-not: Learning to forget in text-to-image diffusion models</em>. arXiv preprint arXiv:2303.17591, 2023.</p>

<p>[4] Hadas Orgad, Bahjat Kawar, and Yonatan Belinkov. <em>Editing implicit assumptions in text-to-image diffusion models</em>. In IEEE International Conference on Computer Vision, ICCV 2023.</p>

<p>[5] Aleksander Madry, Aleksandar Makelov, Ludwig Schmidt, Dimitris Tsipras, and Adrian Vladu. <em>Towards deep learning models resistant to adversarial attacks</em>. arXiv preprint arXiv:1706.06083, 2017.</p>

<p>[6] Bui, Anh, et al. <em>Fantastic Targets for Concept Erasure in Diffusion Models and Where To Find Them</em>. Under review.</p>

          </article>
</div>

      
    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2025 Tuan-Anh  Bui. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script>

  <!-- Bootstrap Table -->
  <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script>

  <!-- Load Common JS -->
  <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script>
  <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script>
  <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-7KGSMMS9MS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ window.dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-7KGSMMS9MS');
  </script>
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

    
  </body>
</html>
